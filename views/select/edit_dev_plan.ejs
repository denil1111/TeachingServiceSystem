<!doctype html>
<html>
<head>
  <% include ../head.html %>
</head>
<body>
<!-- 上方选择条 navbar-top-->
<% include ../navbar.html %>
<!-- 侧边框 -->
<%if(type==0) {%>
<% include slide.html%>
<% }%>
<%if(type==1) {%>
<% include slide_teacher.html%>
<% }%>
<%if(type==2) {%>
<% include slide_manager.html%>
<% }%>
<!--侧边框结束-->
<script type="text/javascript">
  function setActive(){
    console.log('dev_plan');
    var active=document.getElementById('dev_plan');
    active.className='active';
  }
  setActive();
</script>
<!-- 主要内容 -->
<div class="main-content">
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="area-top clearfix">
        <div class="pull-left header">
          <h3 class="title"><i class="icon-dashboard"></i>培养方案</h3>
          <h5>查看本专业培养方案</h5>
        </div>
      </div>
    </div>
  </div>
  <!-- 个人课表 -->
  <div class="span10">
    <div class="box">
      <div class="box-header">
        <span class="title">专业培养方案</span>
      </div>
      <div class="box-content scrollable" style="height: 1000px; overflow-y:auto"> 
        <!-- 通识课部分 -->
       <div class="span9" style="margin-top:20px;">
          <form name="input" action="/select/edit_dev_plan" method="post">
              <div class="input" style="display:inline; text-align:center;">
                  <label style="float:left; margin-top:5px;">专业名称:&nbsp;</label>
                  <select class="uniform" name="major_name">
                      <% for(var i=0;i<major.length;i++){%>
                      <option value="<%= major[i]%>"><%= major[i]%></option>
                      <% } %>
                  </select>
                  <button type="submit" class="btn btn-blue" style="margin-left:30px;">搜索</button>
              </div>
          </form>
        </div>
        <div class="span9" style="margin-top:20px;">
          <div class="box">
             <div class="box-header">
                <span class="title">通识课部分&nbsp;&nbsp;<a href="javascript:edit1()">编辑</a></span>
              </div>
              <div class="box-content padded">
                <table width="100%" class="table table-normal" style="text-align:center;">
                  <thead>
                    <tr>
                      <td style="width:70%">通识课所属类别</td>
                      <td style="width:30%">毕业最低学分</td>
                    </tr>
                  </thead>
                  <tbody>
                    <% for(var i=0;i<dev_plan_gen.length;i++){%>
                    <tr>
                      <td><%= dev_plan_gen[i].name %></td>
                      <td id="gen<%=i%>"><%= dev_plan_gen[i].min_credits %></td>
                    </tr>
                    <%}%>
                  </tbody>  
                 </table>
                 <div style="width:100%;text-align:center; margin-top:15px;" id="save1"> 
                     <button class="btn btn-blue" style="margin-left:30px;" onclick="save1()">保存</button>
                 </div>
              </div>
          </div>
        </div>
        <!-- 专业必修课部分 -->
        <div class="span9" style="margin-top:20px;">
          <div class="box">
             <div class="box-header">
                <span class="title">专业必修课部分&nbsp;&nbsp;
                  <a href="javascript:edit2()">编辑</a>
                  <a href="javascript:addNew1()" id="add1">添加</a>
                </span>
              </div>
              <div class="box-content padded">
                <table width="100%" class="table table-normal" style="text-align:center;">
                      <thead>
                        <tr>
                          <td style="width:20%">课程序号</td>
                          <td style="width:35%">课程名称</td>
                          <td style="width:15%">推荐完成学期</td>
                          <td style="width:20%">课程学分</td>
                        </tr>
                      </thead>
                      <tbody id="req_table_body"> 
                        <% for(var i=0;i<dev_plan_req.length;i++){%>
                        <tr>
                          <td id="req_id<%=i%>"><%= dev_plan_req[i].ID %></td>
                          <td id="req_name<%=i%>"><%= dev_plan_req[i].name %></td>
                          <td id="req_time<%=i%>"><%= dev_plan_req[i].time %></td>
                          <td id="req_credit<%=i%>"><%= dev_plan_req[i].credit %></td>
                        </tr>
                        <%}%>
                      </tbody>  
                     </table>
                    <div style="width:100%;text-align:center; margin-top:15px;" id="save2"> 
                    <button class="btn btn-blue" style="margin-left:30px;" onclick="save2()">保存</button>
                    </div>
              </div>
          </div>
        </div>
        <!-- 专业选修课部分 -->
        <div class="span9" style="margin-top:20px;">
          <div class="box">
             <div class="box-header">
                <span class="title">专业选修课部分&nbsp;&nbsp;<a href="javascript:edit3()">编辑</a></span>
                
              </div>
              <div class="box-content padded">
                <ul>
                  <% for(var i=0;i<dev_plan_elec_class.length;i++){%>
                  <li style="margin-bottom:25px;">
                    <span id="class<%=i%>"><%=dev_plan_elec_class[i].classification%> (最低 <%= dev_plan_elec_class[i].min_credits %> 学分)&nbsp;&nbsp;
                    </span>
                    <a href="javascript:addNew2(<%=i%>)" id="add2_<%=i%>">添加</a>
                    <table width="100%" class="table table-normal" style="text-align:center;">
                      <thead>
                        <tr>
                          <td style="width:20%">课程序号</td>
                          <td style="width:35%">课程名称</td>
                          <td style="width:15%">推荐完成学期</td>
                          <td style="width:20%">课程学分</td>
                        </tr>
                      </thead>
                      <tbody>
                        <% for(var j=0;j<dev_plan_elec[i].length;j++){%>
                        <tr>
                          <td id="elec_id<%=i%>_<%=j%>"><%= dev_plan_elec[i][j].ID %></td>
                          <td id="elec_name<%=i%>_<%=j%>"><%= dev_plan_elec[i][j].name %></td>
                          <td id="elec_time<%=i%>_<%=j%>"><%= dev_plan_elec[i][j].time %></td>
                          <td id="elec_credit<%=i%>_<%=j%>"><%= dev_plan_elec[i][j].credit %></td>
                        </tr>
                        <%}%>
                      </tbody>  
                     </table>
                  </li>
                  <%}%>
                </ul>
                <div style="width:100%;text-align:center; margin-top:15px;" id="save3"> 
                    <button class="btn btn-blue" style="margin-left:30px;" onclick="save3()">保存</button>
                </div>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 主要内容的js -->
<script type="text/javascript">
function hide(){
  $("#save1").hide();
  $("#save2").hide();
  $("#add1").hide();
  <% for(var i=0;i<dev_plan_elec_class.length;i++){%>
  $("#add2_<%=i%>").hide();
  <%}%>
  $("#save3").hide();
}
function edit1(){
  $("#save1").fadeIn();
  <% for(var i=0;i<dev_plan_gen.length;i++){%>
      document.getElementById("gen"+<%=i%>).innerHTML="<input type=\"text\" id=\"input<%=i%>\"value=\"<%= dev_plan_gen[i].min_credits%>\">";
  <%}%>
}
function save1(){
   var new_gen=[];
  <% for(var i=0;i<dev_plan_gen.length;i++){%>
      var tmp=document.getElementById("input"+<%=i%>).value;
      if(tmp==""){
        alert("学分不能为空!");
        return;
      }
      new_gen.push(tmp);
  <%}%>
  <% for(var i=0;i<dev_plan_gen.length;i++){%>
      document.getElementById("gen"+<%=i%>).innerHTML=new_gen[<%=i%>];
  <%}%>
  $("#save1").hide();
   var _json = jQuery.param ({type:"edit_gen",gen:new_gen});  
   var request = $.ajax({  
        url: "/select/edit_dev_plan",  
        type: "POST",  
        async: false,  
        data: _json, //不能直接写成 {id:"123",code:"tomcat"}  
        dataType: "json",  
        // contentType: "charset=utf-8",  
        cache: false,
    });
}
var req_length=<%=dev_plan_req.length%>;
function edit2(){
  $("#save2").fadeIn();
  $("#add1").fadeIn();
  <% for(var i=0;i<dev_plan_req.length;i++){%>
      document.getElementById("req_id"+<%=i%>).innerHTML="<input type=\"text\" id=\"reqIDinput<%=i%>\"value=\"<%= dev_plan_req[i].ID%>\" style=\"width:100%;\">";
      document.getElementById("req_name"+<%=i%>).innerHTML="<input type=\"text\" id=\"reqNameinput<%=i%>\"value=\"<%= dev_plan_req[i].name%>\" style=\"width:100%;\">";
      document.getElementById("req_time"+<%=i%>).innerHTML="<input type=\"text\" id=\"reqTimeinput<%=i%>\"value=\"<%= dev_plan_req[i].time%>\" style=\"width:100%;\">";
      document.getElementById("req_credit"+<%=i%>).innerHTML="<input type=\"text\" id=\"reqCreditinput<%=i%>\"value=\"<%= dev_plan_req[i].credit%>\" style=\"width:100%;\">";
  <%}%>
}
function addNew1(){
  var tmp=req_length;
  var newReq="<tr><td id=\"req_id"+tmp+"\"><input type=\"text\" id=\"reqIDinput"+tmp+"\" style=\"width:100%;\"></td><td id=\"req_name"+tmp+"\"><input type=\"text\" id=\"reqNameinput"+tmp+"\" style=\"width:100%;\"></td><td id=\"req_time"+tmp+"\"><input type=\"text\" id=\"reqTimeinput"+tmp+"\" style=\"width:100%;\"></td><td id=\"req_credit"+tmp+"\"><input type=\"text\" id=\"reqCreditinput"+tmp+"\" style=\"width:100%;\"></td></tr>"
  $("#req_table_body").append(newReq);
  req_length++;
}
function save2(){
  var new_req=[];
  for(var i=0;i<req_length;i++){
    var tmp_id=document.getElementById("reqIDinput"+i).value;
    if(tmp_id=="") {
      alert("课程号不能为空!");
      return;
    }
    var tmp_name=document.getElementById("reqNameinput"+i).value;
    if(tmp_name=="") {
      alert("课程名不能为空!");
      return;
    }
    var tmp_time=document.getElementById("reqTimeinput"+i).value;
    if(tmp_time=="") {
      alert("推荐学期不能为空!");
      return;
    }
    var tmp_credit=document.getElementById("reqCreditinput"+i).value;
    if(tmp_credit=="") {
      alert("课程学分不能为空!");
      return;
    }
    new_req.push({req_id:tmp_id,req_name:tmp_name,req_time:tmp_time,req_credit:tmp_credit});
  }
  for(var i=0;i<req_length;i++){
    document.getElementById("req_id"+i).innerHTML=new_req[i].req_id;
    document.getElementById("req_name"+i).innerHTML=new_req[i].req_name;
    document.getElementById("req_time"+i).innerHTML=new_req[i].req_time;
    document.getElementById("req_credit"+i).innerHTML=new_req[i].req_credit;
  }
  $("#save2").hide();
  $("add1").hide();
  var _json = jQuery.param ({type:"edit_req",req:new_req});  
  var request = $.ajax({  
        url: "/select/edit_dev_plan",  
        type: "POST",  
        async: false,  
        data: _json, //不能直接写成 {id:"123",code:"tomcat"}  
        dataType: "json",  
        // contentType: "charset=utf-8",  
        cache: false,
    });
  location.reload();
}
function edit3(i){
  alert("暂未发布！");
}
hide();
</script>
</body>
</html>